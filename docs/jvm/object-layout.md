
### 1 对象的创建



### 2 对象的内存布局
在HotSpot虚拟机中，对象在内存中存储的布局可以分为3块区域

#### 2.1 `对象头（Header）`
- `Mark Word`
- `类型指针`：指向该对象的Class指针。

另外：如果是一个Java数组，那么对象头还必须有一块用于记录数组长度的数据区域。因为虚拟机可以通过普通Java对象的元数据信息确定对象大小，但从数组的元数据中却无法确定数组大小。
	
#### 2.2 `实例数据（Instance Data）`

程序代码中定义的各种类型的字段内容。

#### 2.3 `对齐填充（Padding）`
并不是必然存在的，也没什么特别的含义。仅仅起着占位符的作用。由于HotSpot虚拟机的自动内存管理系统要求对象起始地址必须是8字节的整数倍，换句话说，就是对象的大小必须是8字节的整数倍。而对象头部分正好是8字节的倍数，因此，当对象实例数据部分没有对齐时，就需要通过对齐填充来补全。


### 3 对象的访问定位

Java程序需要通过栈上的对象引用来操作堆中的对象。Java虚拟机规范中只规定了一个指向对象的引用，并没有定义这个引用应该通过什么方式去定位、访问堆中的对象。所以对象访问方式取决于虚拟机的具体实现。

目前主流的访问方式有使用`句柄`和`直接指针`两种。`Sun HotSpot`采用的是`直接指针`。

- `句柄`。堆中将会划分出一块内存作为句柄池，引用中存储的就是对象的句柄地址。而句柄中包含了对象实例数据与类型数据各自的具体地址信息。
	- 优点：引用中存储的是稳定的句柄地址，在对象被移动时，只会改变句柄中的对象地址，而引用中存储的值不需要修改。
	
<img src="_img/jvm/object-layout/1.png" width="80%"/>

- `直接指针`。堆中的对象布局就必须考虑如何放置访问类型数据的相关信息，而引用中存储的直接就是对象地址。
	- 优点：速度更快。节省了一次指针定位的时间开销。

<img src="_img/jvm/object-layout/2.png" width="80%"/>










